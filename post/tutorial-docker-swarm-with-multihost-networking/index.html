<!doctype html>
<html
  lang="en"
  dir="ltr"
  class="scroll-smooth"
  data-default-appearance="light"
  data-auto-appearance="true"><head>
  <meta charset="utf-8">
  
    <meta http-equiv="content-language" content="en-us">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="theme-color">

  
  
    <title>Tutorial setting up docker-swarm with multihost networking using docker-machine. &middot; Kunal Kushwaha</title>
    <meta name="title" content="Tutorial setting up docker-swarm with multihost networking using docker-machine. &middot; Kunal Kushwaha">
  

  
  
    <meta name="description" content="AI | Golang | Containers | Cloud | Tech">
  
  
  
  
  <link rel="canonical" href="https://kunalkushwaha.github.io/post/tutorial-docker-swarm-with-multihost-networking/">
  

  
  
    <meta name="author" content="Kunal Kushwaha&#39;s Blog">
  
  
    
      
        
          <link href="https://github.com/kunalkushwaha" rel="me">
        
      
    
      
        
          <link href="https://linkedin.com/in/kunalkushwaha" rel="me">
        
      
    
      
        
          <link href="https://twitter.com/kunalkushwaha" rel="me">
        
      
    
  

  
  <meta property="og:url" content="https://kunalkushwaha.github.io/post/tutorial-docker-swarm-with-multihost-networking/">
  <meta property="og:site_name" content="Kunal Kushwaha">
  <meta property="og:title" content="Tutorial setting up docker-swarm with multihost networking using docker-machine.">
  <meta property="og:description" content="AI | Golang | Containers | Cloud | Tech">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2016-01-14T12:45:10+09:00">
    <meta property="article:modified_time" content="2016-01-14T12:45:10+09:00">

  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Tutorial setting up docker-swarm with multihost networking using docker-machine.">
  <meta name="twitter:description" content="AI | Golang | Containers | Cloud | Tech">

  
  
  
  
    
      
    
  
    
      
    
  
    
      
    
  
  
    
  

  
  
  
  
  
  

  

  
  
  
  
  
  
  
  
    
  
  
  <link
    type="text/css"
    rel="stylesheet"
    href="https://kunalkushwaha.github.io/css/main.bundle.min.9a40ac2c977d0575e52e5def309449bca693aeb71d2c7d368f3b47fc0ddf4ad25ea3e2b086fb09e088747ef367344745a5b777c68b95c0cbb639b94758c3878b.css"
    integrity="sha512-mkCsLJd9BXXlLl3vMJRJvKaTrrcdLH02jztH/A3fStJeo&#43;KwhvsJ4Ih0fvNnNEdFpbd3xouVwMu2OblHWMOHiw==">

  
  
  <script
    type="text/javascript"
    src="https://kunalkushwaha.github.io/js/appearance.min.6f41174b3a05b680820fe08cadbfa5fb7a7ca347b76a0955cdc68b9d8aca1ce24f0547e138cea33bcc7904d551a90afcb1cc7f2d9fe8557075d501419046c08c.js"
    integrity="sha512-b0EXSzoFtoCCD&#43;CMrb&#43;l&#43;3p8o0e3aglVzcaLnYrKHOJPBUfhOM6jO8x5BNVRqQr8scx/LZ/oVXB11QFBkEbAjA=="></script>
  
  
  
  
  
    
    <script
      type="text/javascript"
      src="https://kunalkushwaha.github.io/js/zen-mode.min.9814dee9614d32aeb56239d118edfe20acd6231424f9b19c2dd48835038414130a5e946c0d1c9087d60e60e31840c9babfd217e3d4b95643dc8d651a71ccdf4a.js"
      integrity="sha512-mBTe6WFNMq61YjnRGO3&#43;IKzWIxQk&#43;bGcLdSINQOEFBMKXpRsDRyQh9YOYOMYQMm6v9IX49S5VkPcjWUacczfSg=="></script>
  
  
    
    <script src="https://kunalkushwaha.github.io/lib/zoom/zoom.min.umd.b4b722fcb5d42f34f52b30a92f3521b69f403ca9d96d0d6179eb537cb870f5d83fdf1fe836688d95d5c99fefbda4170487711006e56051fa67ea00da10521721.js" integrity="sha512-tLci/LXULzT1KzCpLzUhtp9APKnZbQ1heetTfLhw9dg/3x/oNmiNldXJn&#43;&#43;9pBcEh3EQBuVgUfpn6gDaEFIXIQ=="></script>
  

  
  
  
    
  
  
    
  
  
    
  
  
  
  
  
  
    
    <script
      defer
      type="text/javascript"
      id="script-bundle"
      src="https://kunalkushwaha.github.io/js/main.bundle.min.f16cf48651044bc66625c8008eb5605cc702530530daa081ce7e495e50adf778bef6cd0747382983caf5e5cc745c819dd7a969e17e545119dff14346f4fcb977.js"
      integrity="sha512-8Wz0hlEES8ZmJcgAjrVgXMcCUwUw2qCBzn5JXlCt93i&#43;9s0HRzgpg8r15cx0XIGd16lp4X5UURnf8UNG9Py5dw=="
      data-copy="Copy"
      data-copied="Copied"></script>
  

  
  

<script src="https://kunalkushwaha.github.io/lib/jquery/jquery.slim.min.03cb160e3cfdb2667a2e2c80d283bebcf63ff8bbc4b629c9ab2babf6fae1d0c07ad470edae783efa4fabda2ac01c58d60e63b98b3c336be8208460f08f4354f5.js"></script>


























  

  

  

  

  




  
  
    <link rel="apple-touch-icon" sizes="180x180" href="https://kunalkushwaha.github.io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://kunalkushwaha.github.io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://kunalkushwaha.github.io/favicon-16x16.png">
    <link rel="manifest" href="https://kunalkushwaha.github.io/site.webmanifest">
  

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Posts",
    "name": "Tutorial setting up docker-swarm with multihost networking using docker-machine.",
    "headline": "Tutorial setting up docker-swarm with multihost networking using docker-machine.",
    
    
    "inLanguage": "en-us",
    "url" : "https:\/\/kunalkushwaha.github.io\/post\/tutorial-docker-swarm-with-multihost-networking\/",
    "author" : {
      "@type": "Person",
      "name": "Kunal Kushwaha\u0027s Blog"
    },
    "copyrightYear": "2016",
    "dateCreated": "2016-01-14T12:45:10\u002b09:00",
    "datePublished": "2016-01-14T12:45:10\u002b09:00",
    
    "dateModified": "2016-01-14T12:45:10\u002b09:00",
    
    
    
    "mainEntityOfPage": "true",
    "wordCount": "2325"
  }]
  </script>



  
  
    

  <script
  async
  src="https://www.googletagmanager.com/gtag/js?id=G-K16B935QET"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-K16B935QET');
</script>





  

  
  

  
  

  
  

  
  
</head>


















  
  
  <body class="flex flex-col h-screen m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32 text-lg bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600">
    <div id="the-top" class="absolute flex self-center">
      <a
        class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600"
        href="#main-content">
        <span class="font-bold text-primary-600 pe-2 dark:text-primary-400">&darr;</span>
        Skip to main content
      </a>
    </div>
    
    
      <div class="min-h-[148px]"></div>
<div
  class="fixed inset-x-0 min-h-[130px] opacity-65 bg-gradient-to-b from-neutral from-60% dark:from-neutral-800 to-transparent mix-blend-normal z-80"></div>
<div class="fixed inset-x-0 z-100">
  <div
    id="menu-blur"
    class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl shadow-2xl"></div>
  <div class="relative m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32">
    













<div
  class="main-menu flex items-center justify-between py-6 md:justify-start gap-x-3 pt-[2px] pr-2 md:pr-4 pb-[3px] pl-0">
  
  

  <div class="flex flex-1 items-center justify-between">
    <nav class="flex space-x-3">
      
        <a href="https://kunalkushwaha.github.io/" class="text-base font-medium">
          Kunal Kushwaha
        </a>
      
    </nav>
    
  <nav class="hidden md:flex items-center gap-x-5 md:ml-12 h-12">
    
      
        
  <a
  href="https://kunalkushwaha.github.io/post/"
  
  class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
  aria-label="Blog"
  title="Posts">
  
  
    <p class="text-base font-medium">
      Blog
    </p>
  
</a>



      
        
  <a
  href="https://speakerdeck.com/kunalkushwaha"
  target="_blank"
  class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
  aria-label="Slide Deck"
  title="">
  
  
    <p class="text-base font-medium">
      Slide Deck
    </p>
  
</a>



      
        
  <a
  href="https://kunalkushwaha.github.io/about/"
  
  class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
  aria-label="About"
  title="About Me">
  
  
    <p class="text-base font-medium">
      About
    </p>
  
</a>



      
    

    

    

    
      <button
        id="search-button"
        aria-label="Search"
        class="text-base hover:text-primary-600 dark:hover:text-primary-400"
        title="Search (/)">
        <span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span>
      </button>
    

    
      <div class=" flex items-center">
        <button
          id="appearance-switcher"
          aria-label="Dark mode switcher"
          type="button"
          class="text-base hover:text-primary-600 dark:hover:text-primary-400">
          <div class="flex items-center justify-center dark:hidden">
            <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>
</span>
          </div>
          <div class="items-center justify-center hidden dark:flex">
            <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>
</span>
          </div>
        </button>
      </div>
    
  </nav>

    
  <div class="flex md:hidden items-center gap-x-5 md:ml-12 h-12">
    <span></span>

    

    

    
      <button
        id="search-button-mobile"
        aria-label="Search"
        class="text-base hover:text-primary-600 dark:hover:text-primary-400"
        title="Search (/)">
        <span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span>
      </button>
    

    
      <button
        id="appearance-switcher-mobile"
        aria-label="Dark mode switcher"
        type="button"
        class="text-base hover:text-primary-600 dark:hover:text-primary-400 me-1">
        <div class="flex items-center justify-center dark:hidden">
          <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>
</span>
        </div>
        <div class="items-center justify-center hidden dark:flex">
          <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>
</span>
        </div>
      </button>
    
  </div>

  </div>
  
  <div class="-my-2 md:hidden">
    <div id="menu-button" class="block">
      
        <div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400">
          <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>
</span>
        </div>
        <div
          id="menu-wrapper"
          class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50 pt-[5px]">
          <ul
            class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none text-end max-w-7xl">
            <li id="menu-close-button">
              <span
                class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400">
                <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>
</span>
              </span>
            </li>

            
              
  <li class="mt-1">
  <a
    href="https://kunalkushwaha.github.io/post/"
    
    class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
    aria-label="Blog"
    title="Posts">
    
    
      <p class="text-bg font-bg">
        Blog
      </p>
    
  </a>
</li>



            
              
  <li class="mt-1">
  <a
    href="https://speakerdeck.com/kunalkushwaha"
    
      target="_blank"
    
    class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
    aria-label="Slide Deck"
    title="">
    
    
      <p class="text-bg font-bg">
        Slide Deck
      </p>
    
  </a>
</li>



            
              
  <li class="mt-1">
  <a
    href="https://kunalkushwaha.github.io/about/"
    
    class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
    aria-label="About"
    title="About Me">
    
    
      <p class="text-bg font-bg">
        About
      </p>
    
  </a>
</li>



            

          </ul>
          
        </div>
      
    </div>
  </div>

</div>





  </div>
</div>


<script
  type="text/javascript"
  src="https://kunalkushwaha.github.io/js/background-blur.min.00a57c73ea12f2cab2980c3c3d649e89f6d82f190f74bbe2b67f2f5e39ab7d032ece47086400ca05396758aace13299da49aca43ea643d2625e62c506267a169.js"
  integrity="sha512-AKV8c&#43;oS8sqymAw8PWSeifbYLxkPdLvitn8vXjmrfQMuzkcIZADKBTlnWKrOEymdpJrKQ&#43;pkPSYl5ixQYmehaQ=="
  data-blur-id="menu-blur"></script>

    
    <div class="relative flex flex-col grow">
      <main id="main-content" class="grow">
        
  
  <article>
    
    

    
    <header id="single_header" class="mt-5 max-w-prose">
      
      <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
        Tutorial setting up docker-swarm with multihost networking using docker-machine.
      </h1>
      <div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
        





  
  



  

  
  
  
    
  

  

  
    
  

  

  
    
  

  
    
  

  

  

  

  

  
    
  


  <div class="flex flex-row flex-wrap items-center">
    
    
      <time datetime="2016-01-14T12:45:10&#43;09:00">14 January 2016</time><span class="px-2 text-primary-500">&middot;</span><span>2325 words</span><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">11 mins</span><span class="px-2 text-primary-500">&middot;</span><span class="mb-[2px]">
  <span
    id="zen-mode-button"
    class="text-lg hover:text-primary-500"
    title="Enable zen mode"
    data-title-i18n-disable="Enable zen mode"
    data-title-i18n-enable="Disable zen mode">
    <span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="50px" height="50px">
    <path fill="currentColor" d="M 12.980469 4 C 9.1204688 4 5.9804688 7.14 5.9804688 11 L 6 26 L 9.9804688 26 L 9.9804688 11 C 9.9804688 9.35 11.320469 8 12.980469 8 L 40.019531 8 C 41.679531 8 43.019531 9.35 43.019531 11 L 43.019531 39 C 43.019531 40.65 41.679531 42 40.019531 42 L 29 42 C 29 43.54 28.420938 44.94 27.460938 46 L 40.019531 46 C 43.879531 46 47.019531 42.86 47.019531 39 L 47.019531 11 C 47.019531 7.14 43.879531 4 40.019531 4 L 12.980469 4 z M 7 28 C 4.794 28 3 29.794 3 32 L 3 42 C 3 44.206 4.794 46 7 46 L 23 46 C 25.206 46 27 44.206 27 42 L 27 32 C 27 29.794 25.206 28 23 28 L 7 28 z M 7 32 L 23 32 L 23.001953 42 L 7 42 L 7 32 z"/>
</svg></span></span>
  </span>
</span>

    

    
    
  </div>

  

  
  
    <div class="flex flex-row flex-wrap items-center">
      
        
      
        
          
        
      
        
      
        
          
        
      
    </div>
  

  
  



      </div>
      
        
  
  
  
  
  
  

  

  
    
    
<div class="flex author">
  
  <div class="place-self-center">
    
      <div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">
        Author
      </div>
      <div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">
        Kunal Kushwaha&rsquo;s Blog
      </div>
    
    
      <div class="text-sm text-neutral-700 dark:text-neutral-400">AI | Golang | Containers | Cloud | Tech</div>
    
    <div class="text-2xl sm:text-lg">
  <div class="flex flex-wrap text-neutral-400 dark:text-neutral-500">
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://github.com/kunalkushwaha"
          target="_blank"
          aria-label="Github"
          title="Github"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span></a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://linkedin.com/in/kunalkushwaha"
          target="_blank"
          aria-label="Linkedin"
          title="Linkedin"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
</span></span></a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://twitter.com/kunalkushwaha"
          target="_blank"
          aria-label="Twitter"
          title="Twitter"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
</span></span></a
        >
      
    
  </div>

</div>
  </div>
</div>

  

  

  
    <div class="mb-5"></div>
  

      
    </header>

    
    <section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row">
      
      
      
      
      
        <div class="order-first lg:ml-auto px-0 lg:order-last lg:ps-8 lg:max-w-2xs">
          <div class="toc ps-5 print:hidden lg:sticky lg:top-[140px]">
            
              <details
  open
  id="TOCView"
  class="toc-right mt-0 overflow-y-auto overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg -ms-5 ps-5 pe-2 hidden lg:block">
  <summary
    class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="min-w-[220px] py-2 border-dotted border-s-1 -ms-5 ps-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#installation">Installation.</a></li>
    <li><a href="#creation-of-docker-host-with-machine">Creation of docker host with machine.</a></li>
    <li><a href="#docker-swarm">Docker Swarm</a>
      <ul>
        <li><a href="#discovery-backend-using-consul">Discovery Backend using consul.</a></li>
        <li><a href="#creation-of-swarm-master">Creation of Swarm Master.</a></li>
      </ul>
    </li>
    <li><a href="#understanding-few-more-swarm-functionality">Understanding few more Swarm functionality.</a>
      <ul>
        <li><a href="#filters">Filters</a>
          <ul>
            <li><a href="#use-a-constraint-filter">Use a constraint filter</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</details>
<details class="toc-inside mt-0 overflow-hidden rounded-lg -ms-5 ps-5 lg:hidden">
  <summary
    class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="py-2 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#installation">Installation.</a></li>
    <li><a href="#creation-of-docker-host-with-machine">Creation of docker host with machine.</a></li>
    <li><a href="#docker-swarm">Docker Swarm</a>
      <ul>
        <li><a href="#discovery-backend-using-consul">Discovery Backend using consul.</a></li>
        <li><a href="#creation-of-swarm-master">Creation of Swarm Master.</a></li>
      </ul>
    </li>
    <li><a href="#understanding-few-more-swarm-functionality">Understanding few more Swarm functionality.</a>
      <ul>
        <li><a href="#filters">Filters</a>
          <ul>
            <li><a href="#use-a-constraint-filter">Use a constraint filter</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</details>



            
          </div>
        </div>
      


      <div class="min-w-0 min-h-0 max-w-fit">
        

        <div class="article-content max-w-prose mb-20">
          <p><a
  href="https://github.com/docker/machine"
    target="_blank"
  >Docker-machine</a> is tool to create Docker hosts on computer, on cloud providers, and inside data center. It creates <a
  href="https://docs.docker.com/machine/drivers/os-base/"
    target="_blank"
  >Linux based</a> server, and installs and configures docker. It is also capable of configuring docker-swarm nodes.</p>
<p>This blog, will explain stepwise walkthrough for docker host creation using docker-machine.</p>

<h2 class="relative group">Installation.
    <div id="installation" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#installation" aria-label="Anchor">#</a>
    </span>
    
</h2>
<p>If you use Windows or Mac, Docker has already made awesome packaged installer for you <a
  href="https://www.docker.com/products/docker-toolbox"
    target="_blank"
  >Docker-toolbox</a>. Download and Install it.
For Linux users, you can download docker-machine binaries from <a
  href="https://github.com/docker/machine/releases"
    target="_blank"
  >here</a>.</p>
<p>NOTE: <i> Linux users, do remember, you need to install docker client also on your machine.</i></p>

<h2 class="relative group">Creation of docker host with machine.
    <div id="creation-of-docker-host-with-machine" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#creation-of-docker-host-with-machine" aria-label="Anchor">#</a>
    </span>
    
</h2>
<p>I will be using VirtualBox in this demo, but you can explore cloud options too.</p>
<p>Docker host can be created with command <code>docker-machine create</code>. Here <code>-d</code> flags specifies driver-name. So command looks like as follows.</p>
<p><code>$ docker-machine create -d &lt;driver-name&gt; &lt;name-of-machine&gt;</code></p>
<p>This command does couple of things at backend such as</p>
<ul>
<li>It downloads latest boot2docker image, if not locally available.</li>
<li>Create a machine with <code>name-of-machine</code></li>
<li>Creates ssh keys and copies to machine.</li>
<li>Installs <code>docker</code></li>
<li>Configures docker daemon at port 2376, so that docker daemon accessible at  <code>tcp://&lt;HostIP&gt;:2376</code></li>
</ul>
<p>Lets create our first host <code>testhost</code>.</p>
<pre tabindex="0"><code>$ docker-machine create -d virtualbox testhost
Running pre-create checks...
Creating machine...
(testhost) Copying C:\Users\kunal\.docker\machine\cache\boot2docker.iso to C:\Users\kunal\.docker\machine\machines\testhost\boot2docker.iso...
(testhost) Creating VirtualBox VM...
(testhost) Creating SSH key...
(testhost) Starting VM...
Waiting for machine to be running, this may take a few minutes...
Machine is running, waiting for SSH to be available...
Detecting operating system of created instance...
Detecting the provisioner...
Provisioning with boot2docker...
Copying certs to the local machine directory...
Copying certs to the remote machine...
Setting Docker configuration on the remote daemon...
Checking connection to Docker...
Docker is up and running!
To see how to connect Docker to this machine, run: C:\Program Files\Docker Toolbox\docker-machine.exe env testhost
</code></pre><p>Here our docker host is ready for use. But wait! host is not same machine as your machine right? It is running inside Virtual Machine.
So how docker daemon is accessed remotely?</p>
<p>Docker works on client-server model. Docker daemon is server and it can communicates though <a
  href="https://docs.docker.com/engine/reference/api/docker_remote_api/"
    target="_blank"
  >REST API&rsquo;s</a></p>
<p><i> NOTE: <code>docker-machine create</code> is most important command of docker-machine. Understanding various flags help you to get best of docker-machine. You must spend some time in understanding all <a
  href="https://docs.docker.com/machine/reference/create/"
    target="_blank"
  >flags</a> </i></p>
<ul>
<li>
<p>To access docker host with docker client binary remotely, we need to export some environment variables.
Docker-machine provides a handy command for printing these variables and their values for us as shown below.</p>
<pre tabindex="0"><code>$ docker-machine env testhost
export DOCKER_TLS_VERIFY=&#34;1&#34;
export DOCKER_HOST=&#34;tcp://192.168.99.110:2376&#34;
export DOCKER_CERT_PATH=&#34;C:\Users\kunal\.docker\machine\machines\testhost&#34;
export DOCKER_MACHINE_NAME=&#34;testhost&#34;
# Run this command to configure your shell:
# eval $(&#34;C:\Program Files\Docker Toolbox\docker-machine.exe&#34; env testhost)
</code></pre></li>
<li>
<p>To export all environment variable at once, simply run</p>
<pre tabindex="0"><code>$ eval $(docker-machine env testhost)
</code></pre></li>
<li>
<p>Now all docker commands will communicates with docker daemon of <code>testhost</code></p>
<pre tabindex="0"><code>$ docker info
Containers: 0
Images: 0
Server Version: 1.9.1
Storage Driver: aufs
 Root Dir: /mnt/sda1/var/lib/docker/aufs
 Backing Filesystem: extfs
 Dirs: 0
 Dirperm1 Supported: true
Execution Driver: native-0.2
Logging Driver: json-file
Kernel Version: 4.1.13-boot2docker
Operating System: Boot2Docker 1.9.1 (TCL 6.4.1); master : cef800b - Fri Nov 20 19:33:59 UTC 2015
CPUs: 1
Total Memory: 996.2 MiB
Name: testhost
ID: 26MF:TVKB:JI7Q:TL4S:7RXM:U5CD:VHIR:W2NH:CUNZ:RGB3:C6GC:POBS
Debug mode (server): true
 File Descriptors: 14
 Goroutines: 21
 System Time: 2016-01-07T07:09:51.081394779Z
 EventsListeners: 0
 Init SHA1:
 Init Path: /usr/local/bin/docker
 Docker Root Dir: /mnt/sda1/var/lib/docker
Labels:
 provider=virtualbox
</code></pre></li>
</ul>
<p>Lets create our first docker container on this host.</p>
<pre tabindex="0"><code>$ docker run busybox sh
Unable to find image &#39;busybox:latest&#39; locally
latest: Pulling from library/busybox
c00ef186408b: Pulling fs layer
ac6a7980c6c2: Pulling fs layer
ac6a7980c6c2: Verifying Checksum
ac6a7980c6c2: Download complete
c00ef186408b: Verifying Checksum
c00ef186408b: Download complete
c00ef186408b: Pull complete
ac6a7980c6c2: Pull complete
Digest: sha256:e4f93f6ed15a0cdd342f5aae387886fba0ab98af0a102da6276eaf24d6e6ade0
Status: Downloaded newer image for busybox:latest
</code></pre><p><i> NOTE: If you are one of user, who works behind proxy, then you may face problem like, your newly created docker host may not communicate with <a
  href="https://hub.docker.com/"
    target="_blank"
  >docker-hub</a>.</p>
<p>To Fix that, you need to pass few environment flags at creation time as below.</p>
<pre tabindex="0"><code>$ docker-machine create -d virtualbox \
--engine-env HTTP_PROXY=&#34;http://example.com:8080&#34; \
--engine-env HTTPS_PROXY=&#34;http://example.com:8080&#34; \
testhost
</code></pre></i>
<p>So now we learnt how to create a docker host and run docker containers using docker-machine.
But Docker-machine not only lets you to create independent hosts, but also can put these host in one cluster!</p>
<p>Isn&rsquo;t it interesting?</p>
<p>Let&rsquo;s see how we can build whole cluster of docker-hosts using docker-machine.</p>
<p>Docker <a
  href="https://www.docker.com/products/docker-swarm"
    target="_blank"
  >Swarm</a> is native clustering solution for docker. Here with native means, Swarm understands and exports <a
  href="https://docs.docker.com/swarm/swarm-api/"
    target="_blank"
  >all(almost)</a> docker API&rsquo;s. i.e. API for docker and docker swarm are same.
If one product/scripts works with docker, it will automatically work with swarm :)</p>

<h2 class="relative group">Docker Swarm
    <div id="docker-swarm" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#docker-swarm" aria-label="Anchor">#</a>
    </span>
    
</h2>
<p>Docker swarm has three components.</p>
<ul>
<li>Discovery Backend : Swarm requires a discovery backend, which is used by each node(agent) to discover the master.
<ul>
<li>Default discovery is provided by Docker Hub. (Not for production usage)</li>
</ul>
</li>
<li>Master : Swarm master takes care of all scheduling logic and HA.</li>
<li>Agent : These runs on each node and communicates with Swarm master.
<ul>
<li>All agent node must listen to the same network interface (TCP port).</li>
<li>Each node runs a node agent that registers the referenced Docker daemon, monitors it, and updates the discovery backend with the node’s status</li>
</ul>
</li>
</ul>
<p>In this demo, We will create a docker swarm consisting one Master and three agents including master.
Also, Consul will be used for discovery backend.</p>

<h3 class="relative group">Discovery Backend using consul.
    <div id="discovery-backend-using-consul" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#discovery-backend-using-consul" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>We will create a dedicated machine for consul, but running <a
  href="https://www.consul.io/"
    target="_blank"
  >consul</a> using docker is just one command task.</p>
<pre tabindex="0"><code>$ docker-machine create -d virtualbox \
   --engine-env HTTP_PROXY=&#34;http://example.com:8080&#34; \
   --engine-env HTTPS_PROXY=&#34;http://example.com:8080&#34; \
   swl-consul

$ docker $(docker-machine config swl-consul) run \
   -e &#34;http_proxy=http://example.com:8080&#34; \
   -e &#34;https_proxy=http://example.com:8080&#34; \
   --restart=&#34;always&#34; \
   -d -p &#34;8500:8500&#34; \
   -h &#34;consul&#34; \
   progrium/consul -server -bootstrap
</code></pre><p>Check if consul container is created as expected.</p>
<pre tabindex="0"><code>$ docker-machine ls
NAME         ACTIVE   DRIVER       STATE     URL                         SWARM   DOCKER   ERRORS
swl-consul   -        virtualbox   Running   tcp://192.168.99.100:2376           v1.9.1

$ eval $(docker-machine env swl-consul)

$ docker ps
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                                                            NAMES
5357e85abcb5        progrium/consul     &#34;/bin/start -server -&#34;   16 minutes ago      Up 16 minutes       53/tcp, 53/udp, 8300-8302/tcp, 8400/tcp, 8301-8302/udp, 0.0.0.0:8500-&gt;8500/tcp   goofy_aryabhata
</code></pre>
<h3 class="relative group">Creation of Swarm Master.
    <div id="creation-of-swarm-master" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#creation-of-swarm-master" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>In cluster, we will have one master and 2 agents. But master will also have agent, so practically we will have 3 agents.</p>
<p>Docker machine helps to setup docker host with swarm in single command.</p>
<p>Few highlights of docker machine provisioned swarm enabled host.</p>
<ul>
<li>
<p>Swarm master and agent runs as docker containers.</p>
</li>
<li>
<p>Swarm manager bind on &ldquo;3376&rdquo; port, So to communicate with master <code>tcp://&lt;IP:3376&gt;&gt;</code> should be used.</p>
<pre tabindex="0"><code>$ docker-machine create \
&gt;    -d virtualbox \
&gt;    --swarm \
&gt;    --swarm-master \
&gt;    --swarm-discovery=consul://$(docker-machine ip swl-consul):8500 \
&gt;    --engine-env HTTP_PROXY=http://example.com:8080 \
&gt;    --engine-env HTTPS_PROXY=http://example.com:8080 \
&gt;    --engine-env NO_PROXY=192.168.99.100 \
&gt;    --engine-opt=&#34;cluster-store=consul://$(docker-machine ip swl-consul):8500&#34; \
&gt;    --engine-opt=&#34;cluster-advertise=eth1:3376&#34; \
&gt;    node1
Running pre-create checks...
 .
 .
(node1) Starting VM...
Waiting for machine to be running, this may take a few minutes...
Machine is running, waiting for SSH to be available...
Detecting operating system of created instance...
Detecting the provisioner...
Provisioning with boot2docker...
Copying certs to the local machine directory...
Copying certs to the remote machine...
Setting Docker configuration on the remote daemon...
Configuring swarm...
Checking connection to Docker...
Docker is up and running!
To see how to connect Docker to this machine, run: C:\Program Files\Docker Toolbox\docker-machine.exe env node1

$ eval $(docker-machine env node1)

$ docker ps
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES
7e644b71f606        swarm:latest        &#34;/swarm join --advert&#34;   19 seconds ago      Up 16 seconds                           swarm-agent
58f2a4da438b        swarm:latest        &#34;/swarm manage --tlsv&#34;   22 seconds ago      Up 19 seconds                           swarm-agent-master
</code></pre></li>
</ul>
<p><i> NOTE: You may have seen <code>NO_PROXY</code> is also set as environment variable.</p>
<p>This is to skip proxy for communicating with consul server </i></p>
<p>Here,</p>
<ul>
<li><code>--swarm</code> indicates, swarm agent will be configured.</li>
<li><code>--swarm-master</code> indicates, swarm master will be configured.
<code>--swarm-discovery</code> sets the backend discovery for swarm.</li>
</ul>
<p>Here you go, we have our swarm master node up and running. Before communicating to swarm, let me remind you again.</p>
<ul>
<li>Swarm and docker talks in same API signature. But on our host, we have both docker daemon and swarm running.</li>
<li>Our docker client can communicate with both, but we need to choose whom it has to talk.
<ul>
<li>To talk with docker daemon use <code>eval $(docker-machine env &lt;host-name&gt;)</code></li>
<li>To talk with swarm use <code>eval $(docker-machine env --swarm &lt;host-name&gt;</code></li>
</ul>
</li>
</ul>
<p>So, since we want our docker client should communicate with swarm, we will add <code>--swarm</code></p>
<pre tabindex="0"><code>$ eval $(docker-machine env --swarm node1)

$ docker info
Containers: 2
Images: 1
Role: primary
Strategy: spread
Filters: health, port, dependency, affinity, constraint
Nodes: 1
 node1: 192.168.99.102:2376
  └ Status: Healthy
  └ Containers: 2
  └ Reserved CPUs: 0 / 1
  └ Reserved Memory: 0 B / 1.021 GiB
  └ Labels: executiondriver=native-0.2, kernelversion=4.1.13-boot2docker, operatingsystem=Boot2Docker 1.9.1 (TCL 6.4.1); master : cef800b - Fri Nov 20 19:33:59 UTC 2015, provider=virtualbox, storagedriver=aufs
CPUs: 1
Total Memory: 1.021 GiB
Name: node1
</code></pre><p>Now add two nodes with only agent.</p>
<pre tabindex="0"><code>$ docker-machine create \
&gt;    -d virtualbox \
&gt;    --swarm \
&gt;    --swarm-discovery=&#34;consul://$(docker-machine ip swl-consul):8500&#34; \
&gt;    --engine-env HTTP_PROXY=&#34;http://example.com:8080&#34; \
&gt;    --engine-env HTTPS_PROXY=&#34;http://example.com:8080&#34; \
&gt;    --engine-env NO_PROXY=&#34;192.168.99.100&#34; \
&gt;    --engine-opt=&#34;cluster-store=consul://$(docker-machine ip swl-consul):8500&#34; \
&gt;    --engine-opt=&#34;cluster-advertise=eth1:3376&#34; \  
&gt;    node3
</code></pre><ul>
<li>Command for adding agent doesn&rsquo;t requires <code>--swarm-master</code>.</li>
<li><code>cluster-advertise</code> and <code>cluster-store</code> are required for overlay networking also, Will be explained later.</li>
</ul>
<p>So after adding two more machines with swarm agent, we have 4 machines running as below.</p>
<pre tabindex="0"><code>$ docker-machine ls
NAME         ACTIVE   DRIVER       STATE     URL                         SWARM            DOCKER   ERRORS
node1        -        virtualbox   Running   tcp://192.168.99.102:2376   node1 (master)   v1.9.1
node2        -        virtualbox   Running   tcp://192.168.99.103:2376   node1            v1.9.1
node3        -        virtualbox   Running   tcp://192.168.99.104:2376   node1            v1.9.1
swl-consul   -        virtualbox   Running   tcp://192.168.99.100:2376                    v1.9.1
</code></pre><p>Lets see information of our cluster.</p>
<pre tabindex="0"><code>$ eval $(docker-machine env --swarm node1)

$ docker info
Containers: 4
Images: 3
Role: primary
Strategy: spread
Filters: health, port, dependency, affinity, constraint
Nodes: 3
 node1: 192.168.99.102:2376
  └ Status: Healthy
  └ Containers: 2
  └ Reserved CPUs: 0 / 1
  └ Reserved Memory: 0 B / 1.021 GiB
  └ Labels: executiondriver=native-0.2, kernelversion=4.1.13-boot2docker, operatingsystem=Boot2Docker 1.9.1 (TCL 6.4.1); master : cef800b - Fri Nov 20 19:33:59 UTC 2015, provider=virtualbox, storagedriver=aufs
 node2: 192.168.99.103:2376
  └ Status: Healthy
  └ Containers: 1
  └ Reserved CPUs: 0 / 1
  └ Reserved Memory: 0 B / 1.021 GiB
  └ Labels: executiondriver=native-0.2, kernelversion=4.1.13-boot2docker, operatingsystem=Boot2Docker 1.9.1 (TCL 6.4.1); master : cef800b - Fri Nov 20 19:33:59 UTC 2015, provider=virtualbox, storagedriver=aufs
 node3: 192.168.99.104:2376
  └ Status: Healthy
  └ Containers: 1
  └ Reserved CPUs: 0 / 1
  └ Reserved Memory: 0 B / 1.021 GiB
  └ Labels: executiondriver=native-0.2, kernelversion=4.1.13-boot2docker, operatingsystem=Boot2Docker 1.9.1 (TCL 6.4.1); master : cef800b - Fri Nov 20 19:33:59 UTC 2015, provider=virtualbox, storagedriver=aufs
CPUs: 3
Total Memory: 3.064 GiB
Name: node1
</code></pre><p>Superb! we have three nodes running in our cluster.
This completes the swarm setup!!</p>

<h2 class="relative group">Understanding few more Swarm functionality.
    <div id="understanding-few-more-swarm-functionality" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#understanding-few-more-swarm-functionality" aria-label="Anchor">#</a>
    </span>
    
</h2>
<ol>
<li>Strategy</li>
</ol>
<p>Currently &ldquo;Spread&rdquo; strategy is set. So the containers will be spread over all the hosts in cluster.</p>
<p>e.g.</p>
<pre tabindex="0"><code>$ docker run -d -P -m 1G -e MYSQL_ROOT_PASSWORD=test123 --name db mysql
57a1af46d72117306b833a28a219d3523e1531c98a19ef25cba00a7bc94c9645

$ docker run -d -P -m 1G --name frontend nginx
f40776d7c9f7583965263340c1542a09eb7cb881c53bcf18a290df0d6ce2fd51

$ docker ps
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                                         NAMES
f40776d7c9f7        nginx               &#34;nginx -g &#39;daemon off&#34;   4 seconds ago       Up 4 seconds        192.168.99.103:32770-&gt;80/tcp, 192.168.99.103:32769-&gt;443/tcp   node2/frontend
57a1af46d721        mysql               &#34;/entrypoint.sh mysql&#34;   3 minutes ago       Up 3 minutes        192.168.99.104:32769-&gt;3306/tcp                                node3/db
</code></pre><ul>
<li>Here node3 have <code>db</code> and node2 have <code>frontend</code> container.</li>
<li>If two nodes have the same amount of available RAM and CPUs, the spread strategy prefers the node with least containers.</li>
</ul>
<p>Other available strategies are BinPack and Random.</p>
<ul>
<li>BinPack tries to pack all possible containers on single node first and so on.</li>
<li>If two nodes have the same amount of available RAM and CPUs, the binpack strategy prefers the node with most containers.</li>
</ul>
<p><i>Things to Try:</p>
<ul>
<li>Create swarm with BinPack and create multiple containers to see the behavior. </i></li>
</ul>

<h3 class="relative group">Filters
    <div id="filters" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#filters" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>Filters tell Docker Swarm scheduler which nodes to use when creating and running a container.</p>
<p>Filters are divided into two categories, node filters and container configuration filters.</p>
<ul>
<li>
<p>Node filters operate on characteristics of the Docker host or on the configuration of the Docker daemon.</p>
</li>
<li>
<p>Container configuration filters operate on characteristics of containers, or on the availability of images on a host.</p>
</li>
<li>
<p>Each filter has a name that identifies it.</p>
<p>The node filters are:</p>
<ul>
<li>constraint</li>
<li>health</li>
</ul>
<p>The container configuration filters are:</p>
<ul>
<li>affinity</li>
<li>dependency</li>
<li>port</li>
</ul>
</li>
</ul>
<p>When you start a Swarm manager with the swarm manage command, all the filters are enabled.
If you want to limit the filters available to your Swarm, specify a subset of filters by passing the <code>--filter</code> flag and the name:</p>
<pre tabindex="0"><code>$ swarm manage --filter=health --filter=dependency
</code></pre><p>In case of docker machine, while provisioning <code>--swarm-opt</code> can be used to set filters.</p>

<h4 class="relative group">Use a constraint filter
    <div id="use-a-constraint-filter" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#use-a-constraint-filter" aria-label="Anchor">#</a>
    </span>
    
</h4>
<p>Node constraints can refer to Docker’s default tags or to custom labels. Default tags are sourced from docker info. Often, they relate to properties of the Docker host. Currently, the dafult tags include:</p>
<ul>
<li>node to refer to the node by ID or name</li>
<li>storagedriver</li>
<li>executiondriver</li>
<li>kernelversion</li>
<li>operatingsystem</li>
<li>Custom node labels can be applied while provisioning docker machine.
<ul>
<li><code>--engine-label</code> can be used for setting custom label.</li>
<li>custom label like <code>environment</code>, <code>storage</code> etc are helpful.</li>
</ul>
</li>
</ul>
<p>Since we have all labels same except node name, we will try creating new container using node-name constraint.</p>
<pre tabindex="0"><code>$ docker run -itd -e constraint:node==node3 --name test1 ubuntu
ae4013d014931e43cd5342a625f6b549a8c920cb146b1371a7226359a4bcf014

$ docker run -itd -e constraint:node==node3 --name test2 ubuntu
a6b371773e1a2609122ca68df00d1e03ee274ba3db504d3942c301f8e2c45504

$ docker ps
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
a6b371773e1a        ubuntu              &#34;/bin/bash&#34;         3 seconds ago       Up 2 seconds                            node3/test2
ae4013d01493        ubuntu              &#34;/bin/bash&#34;         19 seconds ago      Up 18 seconds                           node3/test1
934501aed30f        ubuntu              &#34;/bin/bash&#34;         19 hours ago        Up 2 hours                              node3/n4
30358292be89        ubuntu              &#34;/bin/bash&#34;         19 hours ago        Up 19 hours                             node1/n3
6a13aa3eca8b        ubuntu              &#34;/bin/bash&#34;         21 hours ago        Up 21 hours                             node2/n1
</code></pre><p>Similarly other filters can be used. While using filters the syntax to use in <code>docker run</code> is as below.</p>
<pre><code>- ``-e &lt;filter-name&gt;:&lt;key&gt;&lt;operator&gt;&lt;value&gt;``
- Here operator used are  ``==`` , ``!=`` &amp; ``~``
- For ``==`` &amp; ``!=``, exact match is found.
  - If nothing satisfies the condition, it does schedule container.
- ``~`` is for soft condition. i.e. if nothing matches, it ignores the condition and use default scheduler.
- Here value can contain any valid regex (https://github.com/google/re2/wiki/Syntax)
</code></pre>
<p>Hope this article will be helpful in getting started with docker-machine and swarm :)</p>

          
          
          
        </div>
        
        

        
  
  <section class="flex flex-row flex-wrap justify-center pt-4 text-xl">
    
      
        <a
          target="_blank"
          class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
          href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://kunalkushwaha.github.io/post/tutorial-docker-swarm-with-multihost-networking/&amp;title=Tutorial%20setting%20up%20docker-swarm%20with%20multihost%20networking%20using%20docker-machine."
          title="Share on LinkedIn"
          aria-label="Share on LinkedIn">
          <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
</span>
        </a>
      
    
      
        <a
          target="_blank"
          class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
          href="https://twitter.com/intent/tweet/?url=https://kunalkushwaha.github.io/post/tutorial-docker-swarm-with-multihost-networking/&amp;text=Tutorial%20setting%20up%20docker-swarm%20with%20multihost%20networking%20using%20docker-machine."
          title="Tweet on Twitter"
          aria-label="Tweet on Twitter">
          <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg></span>
        </a>
      
    
      
        <a
          target="_blank"
          class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
          href="https://reddit.com/submit/?url=https://kunalkushwaha.github.io/post/tutorial-docker-swarm-with-multihost-networking/&amp;resubmit=true&amp;title=Tutorial%20setting%20up%20docker-swarm%20with%20multihost%20networking%20using%20docker-machine."
          title="Submit to Reddit"
          aria-label="Submit to Reddit">
          <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M201.5 305.5c-13.8 0-24.9-11.1-24.9-24.6 0-13.8 11.1-24.9 24.9-24.9 13.6 0 24.6 11.1 24.6 24.9 0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4 0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8 0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7 0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9 0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5 0 52.6 59.2 95.2 132 95.2 73.1 0 132.3-42.6 132.3-95.2 0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6 0-2.2-2.2-6.1-2.2-8.3 0-2.5 2.5-2.5 6.4 0 8.6 22.8 22.8 87.3 22.8 110.2 0 2.5-2.2 2.5-6.1 0-8.6-2.2-2.2-6.1-2.2-8.3 0zm7.7-75c-13.6 0-24.6 11.1-24.6 24.9 0 13.6 11.1 24.6 24.6 24.6 13.8 0 24.9-11.1 24.9-24.6 0-13.8-11-24.9-24.9-24.9z"/></svg>
</span>
        </a>
      
    
      
        <a
          target="_blank"
          class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
          href="https://www.facebook.com/sharer/sharer.php?u=https://kunalkushwaha.github.io/post/tutorial-docker-swarm-with-multihost-networking/&amp;quote=Tutorial%20setting%20up%20docker-swarm%20with%20multihost%20networking%20using%20docker-machine."
          title="Share on Facebook"
          aria-label="Share on Facebook">
          <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg>
</span>
        </a>
      
    
      
        <a
          target="_blank"
          class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
          href="mailto:?body=https://kunalkushwaha.github.io/post/tutorial-docker-swarm-with-multihost-networking/&amp;subject=Tutorial%20setting%20up%20docker-swarm%20with%20multihost%20networking%20using%20docker-machine."
          title="Send via email"
          aria-label="Send via email">
          <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1c-27.64 140.9 68.65 266.2 199.1 285.1c19.01 2.888 36.17-12.26 36.17-31.49l.0001-.6631c0-15.74-11.44-28.88-26.84-31.24c-84.35-12.98-149.2-86.13-149.2-174.2c0-102.9 88.61-185.5 193.4-175.4c91.54 8.869 158.6 91.25 158.6 183.2l0 16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98 .0036c-7.299 0-13.2 4.992-15.12 11.68c-24.85-12.15-54.24-16.38-86.06-5.106c-38.75 13.73-68.12 48.91-73.72 89.64c-9.483 69.01 43.81 128 110.9 128c26.44 0 50.43-9.544 69.59-24.88c24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3C495.1 107.1 361.2-9.332 207.8 20.73zM239.1 304.3c-26.47 0-48-21.56-48-48.05s21.53-48.05 48-48.05s48 21.56 48 48.05S266.5 304.3 239.1 304.3z"/></svg>
</span>
        </a>
      
    
  </section>


        

      </div>

      
      
        
        
          
          
        
        
        
        <script
          type="text/javascript"
          src="https://kunalkushwaha.github.io/js/page.min.54b6f4371722649edbe871e431d8670d670878c22be8f36e229fe53cc9b786fe25a834def5e6de621f7a3e37b72bc8cd73839aa5ed907ed6cbd45cd3e1b0fa20.js"
          integrity="sha512-VLb0NxciZJ7b6HHkMdhnDWcIeMIr6PNuIp/lPMm3hv4lqDTe9ebeYh96Pje3K8jNc4Oape2QftbL1FzT4bD6IA=="
          data-oid="views_post\tutorial-docker-swarm-with-multihost-networking.md"
          data-oid-likes="likes_post\tutorial-docker-swarm-with-multihost-networking.md"></script>
      
    </section>

    
    <footer class="pt-8 max-w-prose print:hidden">
      
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600">
      <div class="flex justify-between pt-3">
        <span class="flex flex-col">
          
            <a
              class="flex text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
              href="https://kunalkushwaha.github.io/post/understanding-golang-interfaces/">
              <span class="leading-6">
                <span class="inline-block rtl:rotate-180">&larr;</span>&ensp;Understanding Golang Interfaces
              </span>
            </a>
            
              <span class="ms-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400">
                <time datetime="2015-09-11T15:14:46&#43;09:00">11 September 2015</time>
              </span>
            
          
        </span>
        <span class="flex flex-col items-end">
          
            <a
              class="flex text-right text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
              href="https://kunalkushwaha.github.io/post/docker-1.12rc-demo/">
              <span class="leading-6">
                docker 1.12RC demo&ensp;<span class="inline-block rtl:rotate-180">&rarr;</span>
              </span>
            </a>
            
              <span class="me-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400">
                <time datetime="2016-07-25T13:39:38&#43;09:00">25 July 2016</time>
              </span>
            
          
        </span>
      </div>
    </div>
  


      
    </footer>
  </article>

        


  






<div
  id="scroll-to-top"
  class="fixed bottom-6 end-6 z-50 transform translate-y-4 opacity-0 duration-200">
  <a
    href="#the-top"
    class="pointer-events-auto flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
    aria-label="Scroll to top"
    title="Scroll to top">
    &uarr;
  </a>
</div>

      </main><footer id="site-footer" class="py-10 print:hidden">
  
  
    
      
      
        
          
          
      
      
      
      <nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400 ">
        <ul class="flex list-none flex-col sm:flex-row">
          
            <li class=" flex mb-1 text-end sm:mb-0 sm:me-7 sm:last:me-0 ">
              <a
                class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center"
                href="https://kunalkushwaha.github.io/post/"
                title="Posts">
                
                Blog
              </a>
            </li>
          
            <li class=" flex mb-1 text-end sm:mb-0 sm:me-7 sm:last:me-0 ">
              <a
                class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center"
                href="https://kunalkushwaha.github.io/about/"
                title="About Me">
                
                About
              </a>
            </li>
          
        </ul>
      </nav>
    
  
  <div class="flex items-center justify-between">
    
    
      <p class="text-sm text-neutral-500 dark:text-neutral-400">
          Kunal Kushwaha
      </p>
    

    
    
      <p class="text-xs text-neutral-500 dark:text-neutral-400">
        
        
        Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
          href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
          href="https://blowfish.page/" target="_blank" rel="noopener noreferrer">Blowfish</a>
      </p>
    
  </div>
  
    <script>
      mediumZoom(document.querySelectorAll("img:not(.nozoom)"), {
        margin: 24,
        background: "rgba(0,0,0,0.5)",
        scrollOffset: 0,
      });
    </script>
  
  
  
  <script
    type="text/javascript"
    src="https://kunalkushwaha.github.io/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js"
    integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh&#43;sCQ0E53ghYrxgYqw&#43;0GCRyIEpA=="></script>
  
  
</footer>
<div
  id="search-wrapper"
  class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh] z-500"
  data-url="https://kunalkushwaha.github.io/">
  <div
    id="search-modal"
    class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800">
    <header class="relative z-10 flex items-center justify-between flex-none px-2">
      <form class="flex items-center flex-auto min-w-0">
        <div class="flex items-center justify-center w-8 h-8 text-neutral-400">
          <span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span>
        </div>
        <input
          type="search"
          id="search-query"
          class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent"
          placeholder="Search"
          tabindex="0">
      </form>
      <button
        id="close-search-button"
        class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        title="Close (Esc)">
        <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>
</span>
      </button>
    </header>
    <section class="flex-auto px-2 overflow-auto">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

    </div>
  </body>
  
</html>
